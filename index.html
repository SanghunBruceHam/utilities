<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>유틸리티 계산기 모음 | Utilities Collection</title>
    <meta name="description" content="다양한 계산기와 유틸리티 도구 모음집. 일본 연호 변환기, 간지 계산기, 선거 연령 확인기 등 유용한 도구들을 제공합니다.">
    <meta name="keywords" content="계산기, 유틸리티, 일본 연호, 간지, 선거 연령, 변환기, 일본 도구, 무료 계산기">
    <meta name="robots" content="index, follow">
    <meta name="author" content="Utilities Collection">
    <meta name="language" content="Korean">

    <!-- Open Graph -->
    <meta property="og:title" content="유틸리티 계산기 모음">
    <meta property="og:description" content="다양한 계산기와 유틸리티 도구 모음집">
    <meta property="og:url" content="https://utilities.mahalohana-bruce.com">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://utilities.mahalohana-bruce.com/favicon.png">

    <!-- Hreflang -->
    <link rel="alternate" hreflang="ko" href="https://utilities.mahalohana-bruce.com/ko/">
    <link rel="alternate" hreflang="ja" href="https://utilities.mahalohana-bruce.com/ja/">
    <link rel="alternate" hreflang="en" href="https://utilities.mahalohana-bruce.com/en/">
    <link rel="alternate" hreflang="vi" href="https://utilities.mahalohana-bruce.com/vi/">
    <link rel="alternate" hreflang="x-default" href="https://utilities.mahalohana-bruce.com/">

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico?v=2">
    <link rel="icon" type="image/png" href="/favicon.png?v=2">
    <link rel="canonical" href="https://utilities.mahalohana-bruce.com">

    <!-- Preload critical resources -->
    <link rel="preload" href="/favicon.png" as="image" type="image/png">

    <!-- Google Analytics with performance optimization -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WF8ZL9QJHF"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WF8ZL9QJHF', {
            page_title: 'Language Selection',
            page_location: window.location.href
        });
    </script>

    <!-- Microsoft Clarity -->
    <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "ry3utftm89");
    </script>

    <!-- Google AdSense Auto Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" crossorigin="anonymous"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-5508768187151867",
            enable_page_level_ads: true
        });
    </script>

    <!-- Auto Language Detection and Redirect -->
    <!-- 강화된 광고 차단 스크립트 -->
    <script>
        // 언어 선택 영역에서 광고 완전 차단 (강화 버전)
        function aggressiveAdBlocker() {
            const languageSelector = document.querySelector('.language-selector');
            if (!languageSelector) return;

            // 모든 광고 관련 요소들을 강력하게 차단
            const adSelectors = [
                '.adsbygoogle',
                'ins',
                'iframe',
                'embed',
                'object',
                'div[data-ad-client]',
                'div[data-ad-slot]',
                'div[data-ad-format]',
                '[id*="google"]',
                '[class*="google"]',
                '[class*="ad"]',
                '[id*="ad"]',
                'script[src*="googlesyndication"]',
                'script[src*="googleads"]',
                'script[src*="doubleclick"]',
                'script[async]'
            ];

            adSelectors.forEach(selector => {
                try {
                    const elements = languageSelector.querySelectorAll(selector);
                    elements.forEach(el => {
                        // 광고 관련 요소만 제거 (언어 버튼은 보호)
                        if (!el.classList.contains('language-btn') && 
                            !el.classList.contains('language-grid') &&
                            !el.classList.contains('flag') &&
                            !el.classList.contains('text')) {
                            el.style.display = 'none !important';
                            el.style.visibility = 'hidden !important';
                            el.style.height = '0 !important';
                            el.style.width = '0 !important';
                            el.style.overflow = 'hidden !important';
                            el.style.position = 'absolute !important';
                            el.style.left = '-9999px !important';
                            el.style.top = '-9999px !important';
                            el.remove();
                        }
                    });
                } catch (e) {
                    // 에러 무시하고 계속 진행
                }
            });

            // 새로 생성되는 광고 스크립트 차단
            const scripts = languageSelector.querySelectorAll('script');
            scripts.forEach(script => {
                if (script.src && (
                    script.src.includes('googlesyndication') ||
                    script.src.includes('googleads') ||
                    script.src.includes('doubleclick')
                )) {
                    script.remove();
                }
            });
        }

        // 즉시 실행
        aggressiveAdBlocker();

        // DOM이 로드된 후 실행
        document.addEventListener('DOMContentLoaded', aggressiveAdBlocker);

        // 짧은 간격으로 지속적 차단
        setInterval(aggressiveAdBlocker, 500);

        // MutationObserver로 실시간 감지 및 차단
        if (typeof MutationObserver !== 'undefined') {
            const observer = new MutationObserver(function(mutations) {
                let shouldBlock = false;
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                        shouldBlock = true;
                    }
                });
                if (shouldBlock) {
                    setTimeout(aggressiveAdBlocker, 10);
                }
            });

            // 페이지 로드 후 관찰 시작
            document.addEventListener('DOMContentLoaded', function() {
                const languageSelector = document.querySelector('.language-selector');
                if (languageSelector) {
                    observer.observe(languageSelector, {
                        childList: true,
                        subtree: true,
                        attributes: true,
                        attributeOldValue: true
                    });
                }
                // body 전체도 관찰
                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            });
        }

        // 광고 로딩 방지
        const originalCreateElement = document.createElement;
        document.createElement = function(tagName) {
            const element = originalCreateElement.call(this, tagName);
            if (tagName.toLowerCase() === 'script' || tagName.toLowerCase() === 'iframe') {
                // 광고 관련 스크립트/iframe 생성 차단
                element.addEventListener('load', function() {
                    if (this.src && (
                        this.src.includes('googlesyndication') ||
                        this.src.includes('googleads') ||
                        this.src.includes('doubleclick')
                    )) {
                        this.remove();
                    }
                });
            }
            return element;
        };
    </script>

    <script>
        (function() {
            const userLang = navigator.language || navigator.userLanguage;
            const langMap = {
                'ko': '/ko/',
                'ja': '/ja/',
                'en': '/en/',
                'vi': '/vi/',
                'zh': '/ja/',
                'zh-cn': '/ja/',
                'zh-tw': '/ja/'
            };

            const shortLang = userLang.toLowerCase().substring(0, 2);
            const fullLang = userLang.toLowerCase();

            // Check if already on a language-specific page
            if (!window.location.pathname.match(/^\/(ko|ja|en|vi)\//)) {
                const targetLang = langMap[fullLang] || langMap[shortLang] || '/ko/';

                // Add a small delay to allow page to load for SEO
                setTimeout(() => {
                    window.location.href = targetLang;
                }, 100);
            }
        })();
    </script>

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --dark-primary-gradient: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            --bg-color: #ffffff;
            --dark-bg-color: #2d3748;
            --text-color: #2d3748;
            --dark-text-color: #e2e8f0;
            --card-bg: rgba(255, 255, 255, 0.98);
            --dark-card-bg: rgba(45, 55, 72, 0.95);
            --shadow: 0 20px 60px rgba(0,0,0,0.2);
            --dark-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Performance optimization - reduce repaints */
        body, .language-selector, .language-btn {
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: background 0.3s ease, color 0.3s ease;
            font-display: swap; /* Font loading optimization */
        }

        /* Dark mode styles */
        [data-theme="dark"] {
            --primary-gradient: var(--dark-primary-gradient);
            --bg-color: var(--dark-bg-color);
            --text-color: var(--dark-text-color);
            --card-bg: var(--dark-card-bg);
            --shadow: var(--dark-shadow);
        }

        [data-theme="dark"] body {
            background: var(--dark-primary-gradient);
        }

        /* Loading states */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(102, 126, 234, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Page transition effects */
        .page-transition {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease-out forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .language-selector {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow);
            text-align: center;
            max-width: 500px;
            width: 100%;
            position: relative;
            z-index: 1000;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        /* Dark mode toggle */
        .theme-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: 2px solid var(--text-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2em;
            color: var(--text-color);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            transform: rotate(180deg) scale(1.1);
            background: var(--text-color);
            color: var(--bg-color);
        }

        .theme-toggle:focus {
            outline: 2px solid #4a90e2;
            outline-offset: 2px;
        }

        /* 강화된 광고 차단 - 언어 선택 영역 내부에서 광고 완전 차단 */
        .language-selector .adsbygoogle,
        .language-selector ins,
        .language-selector ins[class*="adsbygoogle"],
        .language-selector iframe,
        .language-selector embed,
        .language-selector object,
        .language-selector div[data-ad-client],
        .language-selector div[data-ad-slot],
        .language-selector div[data-ad-format],
        .language-selector [id*="google_ads"],
        .language-selector [id*="google"],
        .language-selector [class*="google-ads"],
        .language-selector [class*="google"],
        .language-selector [class*="adsbygoogle"],
        .language-selector [class*="ad-"],
        .language-selector [id*="ad-"],
        .language-selector script[src*="googlesyndication"],
        .language-selector script[src*="googleads"],
        .language-selector script[src*="doubleclick"],
        .language-selector script[async] {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            width: 0 !important;
            max-height: 0 !important;
            max-width: 0 !important;
            overflow: hidden !important;
            position: absolute !important;
            left: -99999px !important;
            top: -99999px !important;
            opacity: 0 !important;
            pointer-events: none !important;
            z-index: -9999 !important;
            clip: rect(0, 0, 0, 0) !important;
            border: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* 추가 광고 차단 - 광고 컨테이너들 */
        .language-selector > div:has(.adsbygoogle),
        .language-selector > div:has(ins),
        .language-selector > div:has(iframe),
        .language-selector > div:has(script[src*="googlesyndication"]),
        .language-selector div[style*="googlesyndication"],
        .language-selector div[style*="googleads"] {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
        }

        /* 언어 버튼들은 보호 */
        .language-selector .language-btn,
        .language-selector .language-grid,
        .language-selector .flag,
        .language-selector .text,
        .language-selector .title,
        .language-selector .subtitle,
        .language-selector .logo,
        .language-selector .auto-redirect-notice {
            display: block !important;
            visibility: visible !important;
            position: relative !important;
            left: auto !important;
            top: auto !important;
            opacity: 1 !important;
            pointer-events: auto !important;
            z-index: auto !important;
        }

        /* 카드 내부 광고 완전 차단 - 강화 버전 */
        .language-btn .adsbygoogle,
        .language-btn ins,
        .language-btn ins[class*="adsbygoogle"],
        .language-btn iframe,
        .language-btn embed,
        .language-btn object,
        .language-btn div[data-ad-client],
        .language-btn div[data-ad-slot],
        .language-btn div[data-ad-format],
        .language-btn [id*="google_ads"],
        .language-btn [id*="google"],
        .language-btn [class*="google-ads"],
        .language-btn [class*="google"],
        .language-btn [class*="adsbygoogle"],
        .language-btn [class*="ad-"],
        .language-btn [id*="ad-"],
        .language-btn script[src*="googlesyndication"],
        .language-btn script[src*="googleads"],
        .language-btn script[src*="doubleclick"],
        .language-btn script[async],
        .language-grid .adsbygoogle,
        .language-grid ins,
        .language-grid ins[class*="adsbygoogle"],
        .language-grid iframe,
        .language-grid embed,
        .language-grid object,
        .language-grid div[data-ad-client],
        .language-grid div[data-ad-slot],
        .language-grid div[data-ad-format],
        .language-grid [id*="google_ads"],
        .language-grid [id*="google"],
        .language-grid [class*="google-ads"],
        .language-grid [class*="google"],
        .language-grid [class*="adsbygoogle"],
        .language-grid [class*="ad-"],
        .language-grid [id*="ad-"],
        .language-grid script[src*="googlesyndication"],
        .language-grid script[src*="googleads"],
        .language-grid script[src*="doubleclick"],
        .language-grid script[async] {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            width: 0 !important;
            max-height: 0 !important;
            max-width: 0 !important;
            overflow: hidden !important;
            position: absolute !important;
            left: -99999px !important;
            top: -99999px !important;
            opacity: 0 !important;
            pointer-events: none !important;
            z-index: -9999 !important;
            clip: rect(0, 0, 0, 0) !important;
            border: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .logo {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .title {
            font-size: 2em;
            color: #1a202c;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .subtitle {
            color: #2d3748;
            margin-bottom: 30px;
            font-size: 1.1em;
            font-weight: 500;
        }

        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .language-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 25px;
            background: var(--card-bg);
            border: none;
            border-radius: 15px;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1000;
            cursor: pointer;
            outline: none;
            border: 2px solid transparent;
            overflow: hidden;
        }

        /* Ripple effect for visual feedback */
        .language-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(74, 144, 226, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            z-index: -1;
        }

        .language-btn:active::before {
            width: 300px;
            height: 300px;
        }

        .language-btn:focus {
            border-color: #4a90e2;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15), 0 0 0 3px rgba(74, 144, 226, 0.3);
        }

        .language-btn:focus-visible {
            outline: 3px solid #4a90e2;
            outline-offset: 2px;
        }

        .language-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
            background: var(--bg-color);
        }

        /* Loading state for buttons */
        .language-btn.loading {
            opacity: 0.7;
            cursor: not-allowed;
            pointer-events: none;
        }

        .language-btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            right: 15px;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid var(--text-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translateY(-50%);
        }

        /* Enhanced keyboard navigation */
        .language-btn:focus:not(:focus-visible) {
            outline: none;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Skip link for screen readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #000;
            color: #fff;
            padding: 8px;
            text-decoration: none;
            z-index: 10000;
            border-radius: 4px;
        }

        .skip-link:focus {
            top: 6px;
        }

        .flag {
            font-size: 2.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .text {
            flex: 1;
        }

        .text > span:first-child {
            display: block;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 4px;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            transition: color 0.3s ease;
        }

        .lang-name {
            font-size: 0.9rem;
            color: var(--text-color);
            font-weight: 600;
            opacity: 0.8;
            transition: color 0.3s ease, opacity 0.3s ease;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .language-btn {
                border: 3px solid var(--text-color);
            }

            .text > span:first-child,
            .lang-name {
                font-weight: 800;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }

            .loading-spinner {
                animation: none;
                border-top-color: transparent;
                border-left-color: white;
            }
        }

        /* Print styles */
        @media print {
            .theme-toggle,
            .loading-overlay {
                display: none !important;
            }

            body {
                background: white !important;
                color: black !important;
            }
        }

        .auto-redirect-notice {
            font-size: 0.9em;
            color: #888;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        @media (max-width: 480px) {
            .language-selector {
                padding: 30px 20px;
            }

            .title {
                font-size: 1.6em;
            }

            .language-grid {
                grid-template-columns: 1fr;
            }

            .language-btn {
                padding: 12px 15px;
                font-size: 1em;
            }
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            font-weight: 700;
            color: #ffffff;
        }

        .header p {
            font-size: 1.3rem;
            color: #f7fafc;
            font-weight: 400;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay" aria-hidden="true">
        <div class="loading-spinner" aria-label="Loading"></div>
    </div>

    <div class="language-selector page-transition" id="main-content" role="main">
        <!-- Dark mode toggle -->
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode" title="Toggle dark mode">
            <span id="themeIcon">🌙</span>
        </button>

        <div class="logo" role="img" aria-label="Tools emoji">🛠️</div>
        <h1 class="title">Choose Your Language</h1>
        <p class="subtitle">언어를 선택해주세요 / 言語を選択してください</p>

        <div class="language-grid" role="navigation" aria-label="Language selection">
            <a href="/ko/" class="language-btn" role="button" aria-label="한국어로 보기" tabindex="0">
                <span class="flag" aria-hidden="true">🇰🇷</span>
                <span class="text">
                    <span>한국어</span>
                    <span class="lang-name">Korean</span>
                </span>
            </a>

            <a href="/ja/" class="language-btn" role="button" aria-label="日本語で表示" tabindex="0">
                <span class="flag" aria-hidden="true">🇯🇵</span>
                <span class="text">
                    <span>日本語</span>
                    <span class="lang-name">Japanese</span>
                </span>
            </a>

            <a href="/en/" class="language-btn" role="button" aria-label="View in English" tabindex="0">
                <span class="flag" aria-hidden="true">🇺🇸</span>
                <span class="text">
                    <span>English</span>
                    <span class="lang-name">English</span>
                </span>
            </a>

            <a href="/vi/" class="language-btn" role="button" aria-label="Xem bằng tiếng Việt" tabindex="0">
                <span class="flag" aria-hidden="true">🇻🇳</span>
                <span class="text">
                    <span>Tiếng Việt</span>
                    <span class="lang-name">Vietnamese</span>
                </span>
            </a>
        </div>

        <div class="auto-redirect-notice">
            <p>자동으로 브라우저 언어에 맞는 페이지로 이동합니다.</p>
            <p>Automatically redirecting to your browser's language.</p>
        </div>

        <div class="footer">
            <p>© 2025 유틸리티 계산기 모음. 다양한 언어의 무료 온라인 도구들</p>
            <p>일본 연호 변환, 간지 계산, 선거 연령 확인을 쉽고 빠르게 이용하세요.</p>
        </div>
    </div>



    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "유틸리티 계산기 모음",
        "url": "https://utilities.mahalohana-bruce.com",
        "description": "다양한 계산기와 유틸리티 도구 모음집",
        "inLanguage": ["ko-KR", "ja-JP", "en-US", "vi-VN"],
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://utilities.mahalohana-bruce.com/?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>

    <script>
        // Performance optimization: Use RAF for smooth animations
        const rafThrottle = (callback) => {
            let ticking = false;
            return (...args) => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        callback(...args);
                        ticking = false;
                    });
                    ticking = true;
                }
            };
        };

        // Dark mode functionality
        class ThemeManager {
            constructor() {
                this.theme = localStorage.getItem('theme') || 
                    (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
                this.init();
            }

            init() {
                this.applyTheme();
                this.setupToggle();
                this.setupMediaQuery();
            }

            applyTheme() {
                document.documentElement.setAttribute('data-theme', this.theme);
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) {
                    themeIcon.textContent = this.theme === 'dark' ? '☀️' : '🌙';
                }
                localStorage.setItem('theme', this.theme);
            }

            toggle() {
                this.theme = this.theme === 'dark' ? 'light' : 'dark';
                this.applyTheme();

                // Announce to screen readers
                const announcement = `Switched to ${this.theme} mode`;
                this.announceToScreenReader(announcement);
            }

            setupToggle() {
                const toggle = document.getElementById('themeToggle');
                if (toggle) {
                    toggle.addEventListener('click', () => this.toggle());
                    toggle.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            this.toggle();
                        }
                    });
                }
            }

            setupMediaQuery() {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                mediaQuery.addListener((e) => {
                    if (!localStorage.getItem('theme')) {
                        this.theme = e.matches ? 'dark' : 'light';
                        this.applyTheme();
                    }
                });
            }

            announceToScreenReader(message) {
                const announcement = document.createElement('div');
                announcement.setAttribute('aria-live', 'polite');
                announcement.setAttribute('aria-atomic', 'true');
                announcement.className = 'sr-only';
                announcement.style.cssText = `
                    position: absolute;
                    width: 1px;
                    height: 1px;
                    padding: 0;
                    margin: -1px;
                    overflow: hidden;
                    clip: rect(0, 0, 0, 0);
                    white-space: nowrap;
                    border: 0;
                `;
                announcement.textContent = message;
                document.body.appendChild(announcement);
                setTimeout(() => document.body.removeChild(announcement), 1000);
            }
        }

        // Enhanced user experience improvements
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize theme manager
            new ThemeManager();

            // Loading overlay management
            const loadingOverlay = document.getElementById('loadingOverlay');
            const showLoading = () => {
                loadingOverlay.classList.add('active');
                loadingOverlay.setAttribute('aria-hidden', 'false');
            };
            const hideLoading = () => {
                loadingOverlay.classList.remove('active');
                loadingOverlay.setAttribute('aria-hidden', 'true');
            };

            // Enhanced language buttons with improved UX
            const languageButtons = document.querySelectorAll('.language-btn');

            languageButtons.forEach((button, index) => {
                // Staggered animation for visual appeal
                button.style.animationDelay = `${index * 0.1}s`;

                // Enhanced click handling with loading states
                button.addEventListener('click', function(e) {
                    // Prevent multiple clicks
                    if (this.classList.contains('loading')) return;

                    // Add loading state
                    this.classList.add('loading');
                    showLoading();

                    // Haptic feedback for mobile devices
                    if (navigator.vibrate) {
                        navigator.vibrate(50);
                    }

                    // Announce navigation to screen readers
                    const language = this.querySelector('.text > span:first-child').textContent;
                    const announcement = `Navigating to ${language} version`;
                    document.getElementById('themeToggle').closest('.language-selector')
                        .querySelector('.title').setAttribute('aria-live', 'polite');

                    // Simulate network delay for better UX
                    setTimeout(() => {
                        window.location.href = this.href;
                    }, 300);
                });

                // Enhanced keyboard navigation
                button.addEventListener('keydown', function(e) {
                    switch(e.key) {
                        case 'Enter':
                        case ' ':
                            e.preventDefault();
                            this.click();
                            break;
                        case 'ArrowDown':
                        case 'ArrowRight':
                            e.preventDefault();
                            const nextButton = this.nextElementSibling || languageButtons[0];
                            nextButton.focus();
                            break;
                        case 'ArrowUp':
                        case 'ArrowLeft':
                            e.preventDefault();
                            const prevButton = this.previousElementSibling || languageButtons[languageButtons.length - 1];
                            prevButton.focus();
                            break;
                        case 'Home':
                            e.preventDefault();
                            languageButtons[0].focus();
                            break;
                        case 'End':
                            e.preventDefault();
                            languageButtons[languageButtons.length - 1].focus();
                            break;
                    }
                });

                // Enhanced hover effects with throttling
                const handleMouseMove = rafThrottle((e) => {
                    const rect = button.getBoundingClientRect();
                    const x = ((e.clientX - rect.left) / rect.width) * 100;
                    const y = ((e.clientY - rect.top) / rect.height) * 100;
                    button.style.setProperty('--mouse-x', `${x}%`);
                    button.style.setProperty('--mouse-y', `${y}%`);
                });

                button.addEventListener('mousemove', handleMouseMove);
                button.addEventListener('mouseleave', () => {
                    button.style.removeProperty('--mouse-x');
                    button.style.removeProperty('--mouse-y');
                });

                // Intersection Observer for scroll-triggered animations
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.style.animationPlayState = 'running';
                        }
                    });
                }, { threshold: 0.1 });

                observer.observe(button);
            });

            const style = document.createElement('style');
            style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(2);
                        opacity: 0;
                    }
                }

                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }

                .loading-spinner {
                    width: 16px;
                    height: 16px;
                    border: 2px solid #e3e8ee;
                    border-top: 2px solid #667eea;
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                }

                @keyframes slideInUp {
                    from {
                        opacity: 0;
                        transform: translateY(30px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                .language-btn {
                    animation: slideInUp 0.6s ease-out forwards;
                }

                .language-btn:nth-child(1) { animation-delay: 0.1s; opacity: 0; }
                .language-btn:nth-child(2) { animation-delay: 0.2s; opacity: 0; }
                .language-btn:nth-child(3) { animation-delay: 0.3s; opacity: 0; }
                .language-btn:nth-child(4) { animation-delay: 0.4s; opacity: 0; }

                @media (prefers-reduced-motion: reduce) {
                    .language-btn, .language-btn *, * {
                        animation: none !important;
                        transition: none !important;
                    }
                    .language-btn { opacity: 1 !important; }
                }

                .logo {
                    animation: pulse 2s ease-in-out infinite;
                }

                @keyframes pulse {
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                }
            `;
            document.head.appendChild(style);

            // Performance monitoring with Core Web Vitals
            if ('performance' in window) {
                // Monitor loading performance
                window.addEventListener('load', function() {
                    const perfData = performance.getEntriesByType('navigation')[0];
                    if (perfData && perfData.loadEventEnd > 0) {
                        const loadTime = Math.round(perfData.loadEventEnd - perfData.loadEventStart);
                        gtag('event', 'page_load_time', { value: loadTime });

                        // Monitor Core Web Vitals
                        if ('web-vitals' in window) {
                            web-vitals.getCLS(console.log);
                            web-vitals.getFID(console.log);
                            web-vitals.getLCP(console.log);
                        }
                    }
                });

                // Monitor memory usage
                if ('memory' in performance) {
                    setInterval(() => {
                        const memory = performance.memory;
                        if (memory.usedJSHeapSize > memory.jsHeapSizeLimit * 0.8) {
                            console.warn('High memory usage detected');
                        }
                    }, 30000);
                }
            }

            // Service Worker for caching (if available)
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            }

            // Connection quality adaptation
            if ('connection' in navigator) {
                const connection = navigator.connection;
                if (connection.effectiveType === 'slow-2g' || connection.effectiveType === '2g') {
                    // Reduce animations for slow connections
                    document.documentElement.style.setProperty('--animation-duration', '0.1s');
                }
            }
        });

        // Enhanced prefetching with priority
            document.addEventListener('DOMContentLoaded', function() {
                const prefetchUrls = [
                    { url: '/ko/', priority: 'high' },
                    { url: '/ja/', priority: 'high' },
                    { url: '/en/', priority: 'medium' },
                    { url: '/vi/', priority: 'medium' }
                ];

                // Get language buttons first
                const languageButtons = document.querySelectorAll('.language-btn');

                // Use Intersection Observer to prefetch when user shows intent
                const prefetchObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const href = entry.target.href;
                            if (href && !document.querySelector(`link[href="${href}"]`)) {
                                const link = document.createElement('link');
                                link.rel = 'prefetch';
                                link.href = href;
                                link.crossOrigin = 'anonymous';
                                document.head.appendChild(link);
                            }
                        }
                    });
                }, { threshold: 0.5 });

                // Apply observer to language buttons
                if (languageButtons.length > 0) {
                    languageButtons.forEach(button => {
                        prefetchObserver.observe(button);
                    });
                }

                // Immediate prefetch for high priority resources
                setTimeout(() => {
                    prefetchUrls.filter(item => item.priority === 'high').forEach(item => {
                        const link = document.createElement('link');
                        link.rel = 'prefetch';
                        link.href = item.url;
                        link.crossOrigin = 'anonymous';
                        document.head.appendChild(link);
                    });
                }, 1000);
            });
    </script>
</body>
</html>